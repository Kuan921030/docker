# 國立臺灣大學賽車隊軟體研發日誌
###### tags: `研發日誌` `NTURT`
##### 組別: 電系組
##### 負責人: 羅紀翔
##### 次系統: *填入次系統*
##### 次系統編號: *填入次系統編號*
##### 軟體名稱: docker_virtual_environment
##### 存放位置: [github](https://github.com/NTURacingTeam/docker)
##### 開始設計日期: 2022/7/28
##### 目前版本: 2.1
##### 最後更動時間: 2022/8/4
---
## 完整工程目標
Virtual environment are commanly used in order to avoid unnecessary environment setups as a result of different computers with different software installed. Here docker is adoped as a comprehensive virtual environment that is applicable to every software.

## 程式架構
In order to simplify the use of docker, the software uses bash script with prompt to ask user what do they want to do, and then execute docker command accrodingly. For more information for how to use, please refer to `Usage` section in `README.md`.

The software also provides custom dockerfile in `Dockerfile` to build custom images that fit our needs. For more information for what is installed, please refer to `Image environment` section in `README.md`.

## 使用的函式庫
[matlab package manager](https://github.com/mathworks-ref-arch/matlab-dockerfile)

## 測試環境
- bash 5.0.17(1)-release (x86_64-pc-linux-gnu)
- docker 20.10.17, build 100c701

##### 電腦硬體:
- asus tuf gaming a15 FA506II-0031A 4800H
- Raspberry Pi 3B+

##### 作業系統:
- ubuntu20.04
- Raspbian 32bit

##### 編譯器版本(python版本):
- N/A

## 2.5版更動內容
- Add matlab product: Simescape Electrical to ros_matlab
- Changed the default user for ros_rpi image sto root

## 2.6版更動原因
- Using Simescape Electrical for motor model
- To avoid wierd permission problem when accessing /dev

## 2.6版更動時間:
2022/8/15

## 2.6版測試結果
### Launch ros from host by
```bash=
docker -d exec ros bash -c "source /opt/ros/noetic/setup.bash && source /root/ws/devel/setup.bash && roslaunch /root/ws/src/nturt_ros.launch"
```
ros launched successfully

## 2.6版改進方向

---
## 2.5版更動內容
- Minor bug fix
  - fix image build and container access to can hat problem on rpi 
- Add packages need for can to ros_rpi
- Add some library for openAI gym and pytorch to fun_time_with_arthur
- Add some matlab product to ros_matlab

## 2.5版更動原因
- Some problem when using can hat on docker

## 2.5版更動時間:
2022/8/12

## 2.5版測試結果
### Building `ros_rpi` on rpi
Built successfully

### Creating contianer on rpi for can hat usage
Can hat worked successfully

## 2.5版改進方向

---
## 2.4版更動內容
- Minor bug fix
  - mkdir the package directory for the container before creating a container
- Add `Simscape_Driveline` package to matlab

## 2.4版更動原因
- if docker bind-mount without the directory alreadly exist, the directory wiil be created under root permission
- Using imscape_Driveline for vehicle dynamics

## 2.4版更動時間:
2022/8/5

## 2.4版測試結果
### Creating a continer without the package directory exist
created successfully without permission problem

## 2.4版改進方向
- Not tested on raspberry pi yet

---
## 2.3版更動內容
- Minor bug fix
  - Using older version of matlab in prevention of glibc version problem
- Add `Vehicle_Dynamics_Blockset` package to matlab

## 2.3版更動原因
- Crash when activating simulink as a result of too old version of glibc of ubuntu20.04
- Using Vehicle_Dynamics_Blockset for vehicle dynamics

## 2.3版更動時間:
2022/8/4

## 2.3版測試結果
### Activating simulink
successfully

## 2.3版改進方向
- Not tested on raspberry pi yet

---
## 2.2版更動內容
- Minor bug fix
  - Give /usr/share/matlab/licenses permission for everone as matlab is installed in root user
- Make the script useable for hosts without nvidia docker support

## 2.2版更動原因
- Matlab have to have permission to /usr/share/matlab/licenses in order to activate
- The script was original only usable for hosts with nvidia docker support

## 2.2版更動時間:
2022/8/4

## 2.2版測試結果
### ros_matlab
Permission problem resolved successfully
### Create container with nvidia docker support
run
```bash=
./start_container create ros roe_matlab
```
with nvidia docker support
created successfully
### Create container without nvidia docker support
run
```bash=
./start_container create ros roe_matlab
```
without nvidia docker support
created successfully

## 2.2版改進方向
- Not tested on raspberry pi yet

---
## 2.1版更動內容
- Minor bug fix
  - Reverse the order of sourcing ros and ros workspace in .bashrc
- Reformat 軟體日誌 to newer version

## 2.1版更動原因
- Sourcing ros workapsce before sourcing ros have no effect

## 2.1版更動時間:
2022/8/4

## 2.1版測試結果
### ros_matlab
Auto-sourcing ~/ws/devel/setup.bash Successfully

### fun_time_with_arthur
Auto-sourcing ~/ws/devel/setup.bash Successfully

## 2.1版改進方向
- Currently creating a container always uses some specific configuration (always using gpu), will be changed in the next version
- Not tested on raspberry pi yet

---
## 2.0版更動內容
- Added three other dockerfiles for different needs, including
  - ros_host: image with ros for desktop use
  - ros_matlab: image with ros and matlabfor desktop use
  - ros_rpi: image with ros for use on raspberry pi
- Rewrite dockerfiles to shorten the build stepts

## 2.0版更動原因
- Add other images for different needs, especially ros_matlab for future developments
- Rewrite dockerfiles for better performances, please checkout [Better practice for writting dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)

## 2.0版更動時間:
2022/7/30

## 2.0版測試結果
### Test building image
runing
```bash=
./build_image fun_time_with_arthur
./build_image ros_matlab
```
Built successfully

## 2.0版改進方向
- Currently creating a container always uses some specific configuration
- Not tested on raspberry pi yet

---
## 1.0版更動時間:
2022/7/28

## 1.0版測試結果
### Test building image
runing
```bash=
./build_image fun_time_with_arthur
```
#### Without an image with same name and tag `latest`
Built successfully
#### With an image with same name and tag `latest`
Built successfully

### Test create/run/shell/stop container
runing
```bash=
./start_container COMMAND CONTAINER_NAME [IMAGE_NAMME]
```
All worked successfully

## 1.0版改進方向
- Currently creating a container always uses some specific configuration, which should be change to be configuratable.
- The `ros_uuv_rpi` image should be updated, tested and documented in `README.md`.
- Should add an image with only desktop ros.
